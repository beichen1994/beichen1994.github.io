---
title: 爬虫之6Selenium
date: 2020-02-08 22:48:50
tags:
- 爬虫
categories: 
- Computer
---


# Selenium
自动化测试工具，支持多种浏览器，
爬虫中主要用来解决JavaScript渲染的问题·
## 基本使用
```
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.support.wait import WebDriverWait

browser = webdriver.Edge()

try:
    browser.get("https://www.baidu.com")
    
    input = browser.find_element_by_id('kw')
    input.send_keys('Python')
    input.send_keys(Keys.ENTER)
    
    wait = WebDriverWait(browser,10)
    wait.until(EC.presence_of_element_located((By.ID,'content_left')))
    print(browser.current_url)
    print("\n")
    print(browser.get_cookies)
    print("\n")
    print(browser.page_source)
finally:
    browser.close()
```
## 声明浏览器对象
```
from selenium import webdriver

browser = webdriver.Edge()
browser = webdriver.Chrome()
browser = webdriver.Safari()
```
## 访问页面
```
from selenium import webdriver

browser=webdriver.Edge()
browser.get("https://www.taobao.com")
print(browser.page_source)
browser.close()

```
## 查找元素
### 单个元素
find_element_by_id(id)
find_element_by_name(name)
find_element_by_xpath(xpath)
find_element_by_link_text(link_text)
find_element_by_partial_link_text(link_text)
find_element_by_tag_name(name)
find_element_by_class_name(name)
find_element_by_css_selector(css_selector)
```
from selenium import webdriver
browser=webdriver.Edge()
browser.get("https://www.taobao.com")
input_first=browser.find_element_by_id('q')

input_second=browser.find_element_by_css_selector('#q')
print(input_first,"\n",input_second)
browser.close()
```
```
from selenium import webdriver
from selenium.webdriver.common.by import By

browser=webdriver.Edge()
browser.get("https://www.taobao.com")
input_first=browser.find_element_by_id('q')
print(input_first)
browser.close()
```
### 多个元素
find_elements_by_id(id)
find_elements_by_name(name)
find_elements_by_xpath(xpath)
find_elements_by_link_text(link_text)
find_elements_by_partial_link_text(link_text)
find_elements_by_tag_name(name)
find_elements_by_class_name(name)
find_elements_by_css_selector(css_selector)
```
from selenium import webdriver

browser=webdriver.Edge()
browser.get("https://www.taobao.com")
list=browser.find_elements(By.CSS_SELECTOR,'.service-bd li')
for li in list:
    print(li)
    print("\n")
browser.close()
```
## 获取元素信息
### 获取属性
![50ce3c9ce444a2bc349ab074ffd527dd.png](en-resource://database/5638:1)
```
from selenium import webdriver
from selenium.webdriver import ActionChains

browser=webdriver.Edge()
url='https://www.zhihu.com/explore'
browser.get(url)
logo=browser.find_element_by_id('zh-top-link-logo')
print(logo)
print(logo.get_attribute('class'))

```
### 获取文本值
![4f23433f2a2fbda57bfa8047ab6a6fd5.png](en-resource://database/5640:1)
```
from selenium import webdriver

browser=webdriver.Edge()
url='https://www.zhihu.com/explore'
browser.get(url)
input=browser.find_element_by_class_name('zu-top-add-question')
print(input.text)
```
### 获取ID 位置 标签名 大小
```
from selenium import webdriver

browser=webdriver.Edge()
url='https://www.zhihu.com/explore'
browser.get(url)
input=browser.find_element_by_class_name('zu-top-add-question')
print(input.id)
print(input.location)
print(input.tag_name)
print(input.size)
```


## 元素交互操作
![859854106ae735de2381b2aa59f373ea.png](en-resource://database/5636:1)
```
from selenium import webdriver
import time

browser = webdriver.Edge()
browser.get("https://www.taobao.com")
input=browser.find_element_by_id('q')
input.send_keys('iphone')
time.sleep(1)
input.clear()
input.send_keys('surface')
button=browser.find_element_by_class_name('btn-search')
button.click()
```
## 执行JavaScript
```
from selenium import webdriver

browser=webdriver.Edge()
browser.get("http://www.zhihu.com/explore")
browser.execute_script('window.scrollTo(0,document.body.scrollHeight)')
browser.execute_script('alert("To Bottom")')
```

## Frame
![86922b0c8564e32ec7d2dcac3b965999.png](en-resource://database/5642:1)

```
import time
from selenium import webdriver
from selenium.common.exceptions import NoSuchElementException

browser=webdriver.Edge()
url='http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable'
browser.get(url)
browser.switch_to.frame('iframeResult')
source=browser.find_element_by_css_selector('#draggable')
print(source)
try:
    logo=browser.find_element_by_class_name('logo')
except NoSuchElementException:
    print('NoLogo')
browser.switch_to.parent_frame()
logo=browser.find_element_by_class_name('logo')
print(logo)
print(logo.text)
```
## 隐式等待
如果WebDriver没有立即在DOM中找到元素，将继续等待一段时间再查找DOM，找不到则抛出异常
```
from selenium import webdriver

browser=webdriver.Edge()
browser.implicitly_wait(10)
browser.get("https://www.zhihu.com/explore")
input=browser.find_element_by_class_name("zu-top-add-question")
print(input)
```

## 显示等待
```
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

browser=webdriver.Edge()
browser.get("https://www.taobao.com")
wait=WebDriverWait(browser,10)
input = wait.until(EC.presence_of_element_located((By.ID,'q')))
button= wait.until(EC.element_to_be_clickable((By.CSS_SELECTOR,'.btn-search')))
print(input,'\n',button)
```
## 前进后退
```
import time
from selenium import webdriver

browser=webdriver.Edge()
browser.get("https://www.taobao.com/")
browser.get("https://www.baidu.com/")
browser.get("https://www.zhihu.com/")
browser.back()
time.sleep(1)
browser.forward()
browser.close()
```
## 选项卡管理
```
import time 
from selenium import webdriver

browser = webdriver.Edge()
browser.get("https://www.baidu.com")
browser.execute_script('window.open()')
print(browser.window_handles)

browser.switch_to_window(browser.window_handles[1])
browser.get("https://www.taobao.com")
time.sleep(1)
browser.switch_to_window(browser.window_handles[0])
browser.get("https://www.zhihu.com")
```
## 异常处理
```
from selenium import webdriver

browser=webdriver.Edge()
try:
    browser.get("https://www.baidu.com")
except TimeoutException:
    print("Time Out")
try:
    browser.find_element_by_id("hello")
except NoSuchElementException:
    print("No Element")
finally:
    browser.close()

```

## 下拉选择框select处理
```
<!DOCTYPE html> 
<html lang="en"> 
<head> 
<meta charset="UTF-8"> 
<title>selenium 处理 下拉框</title> 
</head>
 <body bgcolor="#f0f8ff"> 
 <h3 align="center">selenium下拉框处理方法</h3> 
 <hr/> 
 <td align="center">下拉框demo</td> 
 <br/>
 <select id="selectdemo" class="select" name="selectdemo">
 <option name="jiaolian" value="210101" selected="selected">教练人员</option> 
 <option name="pingpang" value="210102">乒乓球球员</option> 
 <option name="lanqiu" value="210103 ">篮球运动员</option> 
 <option name="zuqiu" value="210103  ">足球运动员</option> 
 <option name="youyong" value="210402">游泳运动员</option> 
 <option name="tiaoshui" value="210403">跳水运动员</option> 
 </select> 
 </body> 
 </html>

```
### 1.使用Webdriver提供的Select类的方法
```
from selenium.webdriver.support.select import Select
select_by_value(value)
select_by_index(index)
select_by_visible_text(text)
```
```

选择篮球运动员选项
# 实例化一个Select类的对象 
selector = Select(driver.find_element_by_id("selectdemo")) 
# 下面三种方法用于选择"篮球运动员" 
selector.select_by_index("2") # 通过index进行选择,index从0开始 
selector.select_by_value("210103") # 通过value属性值进行选择 
selector.select_by_visible_text("篮球运动员") # 通过标签显示的text进行选择

```
### 2. 先定位select 然后在定位option
```
# 定位到下拉选择框 
selector = driver.find_element_by_id("selectdemo") 
# selector = driver.find_element_by_xpath(".//*[@id='selectdemo']") 
# 选择"篮球运动员" 
selector.find_element_by_xpath("//option[@value='210103']").click() 
# selector.find_elements_by_tag_name("option")[2].click()

```
### 3.直接通过xpath层级标签定位
```
driver.find_element_by_xpath(".//*[@id='selectdemo']/option[3]").click()
```



