---
title: 爬虫之7多线程
date: 2020-02-08 22:50:44
tags:
- 爬虫
categories: 
- Computer
---

# 多线程


## 第一种
import threading 
创建一个活动函数
threading.Thread(target = 函数名,args = (a,b))

```
from time import ctime
import threading

#自定义函数coding()
def coding(language):
    for i in range(5):
        print("I\'m coding ",language," program at ",ctime() )
        
#自定义函数music()
def music():
    for i in range(5):
        print("I\'m listening music at ",ctime())

        
if __name__ == "__main__":
    print("线程%s在运行..." % threading.current_thread().name)
    
    thread_list = []
    
    #创建线程
    t1 = threading.Thread(target = coding,args=('python',))
    #args=(3),会认为是一个数字 args=(3,) 会认为是一个元组
    t2 = threading.Thread(target = music)
    
    thread_list.append(t1)
    thread_list.append(t2)
    
    for t in thread_list:
        t.setDaemon(True) #设置为守护线程
        #当JVM中所有的线程都是守护线程的时候，JVM就可以退出了；
        #如果还有一个或以上的非守护线程则不会退出
        #等待主线程运行完毕后销毁
        
        t.start() #执行线程
        t.join() # 在子线程运次结束之前，主线程被阻塞
    
    print("线程%s停止!" % threading.current_thread().name)
```

## lock锁
对共享变量，需要加锁
多线程，容易发生冲突，必须用锁加以隔离，同时，又要小心死锁的发生

```
import threading 

sum = 0
lock = threading.Lock()  #创建一个锁

#自定义函数
def put_money(money):
    global sum   #全局变量，可共享
    sum = sum+money

def get_money(money):
    global sum   #全局变量，可共享
    sum = sum-money
    
def cunqu(money):
    lock.acquire() # 改动1.. 先要获取锁
    try:
        for i in range(1000000):  #执行次数必须足够多，才能体现出特点来
            #先存再取，钱数应该为0
            put_money(money)
            get_money(money)
    except:
        lock.release()  # 改动2..别忘了释放锁:

t1 = threading.Thread(target=cunqu,args=(500,))
t2 = threading.Thread(target=cunqu,args=(1000,))
t1.start()
t2.start()
t1.join()
t2.join()
print(sum)
```

## 第二种
```
from threading import Thread
import time 

#继承 threading.Thread类

class Eat(Thread):
    def __init__(self,name):
        super().__init__()
        self.name = name
        
    #功能实现    
    def run(self):
        time.sleep(2)
        print('%s is eating '%self.name)
        
if __name__ == '__main__':
    t = Eat('ff')
    t.start()
    print('🐷')
```